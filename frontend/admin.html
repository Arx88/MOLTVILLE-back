<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MOLTVILLE | Administraci√≥n</title>
  <link rel="stylesheet" href="./admin.css?v=20260210c">
</head>
<body>
  <div class="admin-layout">
    <aside class="admin-sidebar">
      <div class="sidebar-brand">
        <span>üèôÔ∏è</span>
        <div>
          <p class="brand-title">MOLTVILLE</p>
          <p class="brand-subtitle">Panel de administraci√≥n</p>
        </div>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item is-active" data-tab="general">General</button>
        <button class="nav-item" data-tab="security">Seguridad</button>
        <button class="nav-item" data-tab="agents">Agentes</button>
        <button class="nav-item" data-tab="economy">Econom√≠a</button>
        <button class="nav-item" data-tab="governance">Gobernanza</button>
        <button class="nav-item" data-tab="events">Eventos</button>
        <button class="nav-item" data-tab="npcs">NPCs</button>
        <button class="nav-item" data-tab="health">Health</button>
        <button class="nav-item" data-tab="scheduler">Scheduler</button>
        <button class="nav-item" data-tab="show-mode">Show Mode</button>
        <button class="nav-item" data-tab="kick">Kick & Streaming</button>
        <button class="nav-item" data-tab="analytics">Analytics</button>
        <button class="nav-item" data-tab="observability">Observabilidad</button>
      </nav>
      <a class="back-link" href="./portal.html">‚Üê Volver al portal</a>
    </aside>

    <main class="admin-content">
      <header class="admin-header">
        <div>
          <h1>Configuraci√≥n total</h1>
          <p>Centraliza todos los par√°metros de MOLTVILLE en un solo lugar.</p>
        </div>
        <div class="header-actions">
          <input class="admin-key-input" id="admin-auth-key" type="password" placeholder="Admin key para autenticar">
          <button class="ghost" id="restart-server" type="button">Reiniciar</button>
          <button class="ghost" id="reset-config" type="button">Restaurar</button>
          <button class="primary" id="save-config" type="button">Guardar cambios</button>
        </div>
      </header>

      <section class="admin-panel is-active" id="panel-general">
        <h2>General</h2>
        <div class="panel-grid">
          <label>
            Puerto del servidor
            <input type="number" name="PORT" value="3001">
          </label>
          <label>
            URL del frontend
            <input type="text" name="FRONTEND_URL" value="http://localhost:5173">
          </label>
          <label>
            Tick rate (ms)
            <input type="number" name="WORLD_TICK_RATE" value="100">
          </label>
          <label>
            Grace disconnect (ms)
            <input type="number" name="AGENT_DISCONNECT_GRACE_MS" value="15000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-security">
        <h2>Seguridad</h2>
        <div class="panel-grid">
          <label>
            ADMIN_API_KEY
            <input type="text" name="ADMIN_API_KEY" placeholder="clave_admin">
          </label>
          <label>
            Viewer API Key
            <input type="text" name="VIEWER_API_KEY" placeholder="clave_viewer">
          </label>
          <label>
            Rate limit API
            <input type="number" name="API_RATE_LIMIT" value="100">
          </label>
          <label>
            Ventana rate limit (ms)
            <input type="number" name="API_RATE_WINDOW_MS" value="60000">
          </label>
          <label>
            Socket rate limit (ms)
            <input type="number" name="SOCKET_RATE_LIMIT_MS" value="200">
          </label>
          <label>
            Socket speak (ms)
            <input type="number" name="SOCKET_SPEAK_LIMIT_MS" value="800">
          </label>
          <label>
            Socket perceive (ms)
            <input type="number" name="SOCKET_PERCEIVE_LIMIT_MS" value="250">
          </label>
          <label>
            M√°x strikes
            <input type="number" name="SOCKET_RATE_MAX_STRIKES" value="5">
          </label>
          <label>
            Bloqueo rate (ms)
            <input type="number" name="SOCKET_RATE_BLOCK_MS" value="30000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-agents">
        <h2>Agentes</h2>
        <div class="panel-grid">
          <label>
            Memoria interacciones (max)
            <input type="number" name="MEMORY_INTERACTIONS_MAX" value="200">
          </label>
          <label>
            Memoria ubicaciones (max)
            <input type="number" name="MEMORY_LOCATIONS_MAX" value="100">
          </label>
          <label>
            Memoria TTL (ms)
            <input type="number" name="MEMORY_MAX_AGE_MS" value="604800000">
          </label>
          <label>
            Prune interval (ms)
            <input type="number" name="MEMORY_PRUNE_INTERVAL_MS" value="600000">
          </label>
        </div>
        <div class="agent-llm-section">
          <div class="agent-llm-header">
            <h3>LLM por agente</h3>
            <div class="agent-llm-actions">
              <button class="ghost" id="connect-qwen" type="button">Conectar Qwen (OAuth)</button>
              <button class="ghost" id="sync-qwen" type="button">Sincronizar Qwen OAuth</button>
            </div>
          </div>
          <div class="agent-llm-list" id="agent-llm-list"></div>
        </div>
      </section>

      <section class="admin-panel" id="panel-economy">
        <h2>Econom√≠a</h2>
        <div class="panel-grid">
          <label>
            Ingreso base
            <input type="number" name="BASE_INCOME" value="2">
          </label>
          <label>
            Intervalo de ingreso (ms)
            <input type="number" name="INCOME_INTERVAL_MS" value="60000">
          </label>
          <label>
            Balance inicial
            <input type="number" name="STARTING_BALANCE" value="10">
          </label>
          <label>
            Umbral de reviews
            <input type="number" name="REVIEW_THRESHOLD" value="2.5">
          </label>
          <label>
            Database URL
            <input type="text" name="DATABASE_URL" placeholder="postgres://user:pass@localhost:5432/moltville">
          </label>
          <label>
            DB_SSL
            <select name="DB_SSL">
              <option value="false">false</option>
              <option value="true">true</option>
            </select>
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-governance">
        <h2>Gobernanza</h2>
        <div class="panel-grid">
          <label>
            Duraci√≥n de votaci√≥n (ms)
            <input type="number" name="BUILDING_VOTE_DURATION_MS" value="86400000">
          </label>
          <label>
            Opciones por votaci√≥n
            <input type="number" name="BUILDING_VOTE_OPTIONS" value="4">
          </label>
          <label>
            Propuestas por agente
            <input type="number" name="BUILDING_VOTE_PROPOSALS" value="1">
          </label>
          <label>
            TTL propuestas (ms)
            <input type="number" name="BUILDING_PROPOSAL_TTL_MS" value="604800000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-events">
        <h2>Eventos</h2>
        <div class="panel-grid">
          <label>
            Duraci√≥n del d√≠a (ms)
            <input type="number" name="DAY_LENGTH_MS" value="7200000">
          </label>
          <label>
            Cambio de clima (ms)
            <input type="number" name="WEATHER_CHANGE_MS" value="3600000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-npcs">
        <h2>NPCs</h2>
        <div class="panel-grid">
          <label>
            M√≠n agentes reales
            <input type="number" name="NPC_MIN_REAL_AGENTS" value="5">
          </label>
          <label>
            M√°x NPCs
            <input type="number" name="NPC_MAX_COUNT" value="4">
          </label>
          <label>
            Ratio max NPCs
            <input type="number" step="0.1" name="NPC_MAX_RATIO" value="0.5">
          </label>
          <label>
            Intervalo de comportamiento (ms)
            <input type="number" name="NPC_BEHAVIOR_INTERVAL_MS" value="45000">
          </label>
          <label>
            Gracia despawn (ms)
            <input type="number" name="NPC_DESPAWN_GRACE_MS" value="120000">
          </label>
          <label>
            Intervalo spawn check (ms)
            <input type="number" name="NPC_SPAWN_CHECK_MS" value="30000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-health">
        <h2>Health Monitor</h2>
        <div class="panel-grid">
          <label>
            Intervalo health check (ms)
            <input type="number" name="HEALTH_CHECK_INTERVAL_MS" value="10000">
          </label>
          <label>
            Umbral baja poblaci√≥n
            <input type="number" name="HEALTH_LOW_POPULATION" value="3">
          </label>
          <label>
            Latencia tick cr√≠tica (ms)
            <input type="number" name="HEALTH_TICK_LATENCY_MS" value="500">
          </label>
          <label>
            Circuit breaker ventana (ms)
            <input type="number" name="HEALTH_CIRCUIT_WINDOW_MS" value="60000">
          </label>
          <label>
            Circuit breaker fallos
            <input type="number" name="HEALTH_CIRCUIT_FAILURES" value="5">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-scheduler">
        <h2>Event Scheduler</h2>
        <div class="panel-grid">
          <label>
            Intervalo scheduler (ms)
            <input type="number" name="EVENT_SCHEDULE_INTERVAL_MS" value="60000">
          </label>
          <label>
            Chance eventos aleatorios
            <input type="number" step="0.01" name="EVENT_RANDOM_CHANCE" value="0.15">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-show-mode">
        <h2>Show Mode 2.0</h2>
        <div class="panel-grid">
          <label>
            Min escena (ms)
            <input type="number" name="SHOW_MODE_MIN_SCENE_MS" value="10000">
          </label>
          <label>
            Ventana de decay (ms)
            <input type="number" name="SHOW_MODE_DECAY_WINDOW_MS" value="30000">
          </label>
          <label>
            Umbral de switch
            <input type="number" name="SHOW_MODE_SWITCH_THRESHOLD" value="15">
          </label>
          <label>
            L√≠mite de cola
            <input type="number" name="SHOW_MODE_QUEUE_LIMIT" value="3">
          </label>
          <label>
            L√≠mite de tramas
            <input type="number" name="SHOW_MODE_THREADS_LIMIT" value="6">
          </label>
          <label>
            Predicciones activas
            <select name="SHOW_MODE_PREDICTIONS_ENABLED">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
          <label>
            Arcos activos
            <select name="SHOW_MODE_ARCS_ENABLED">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
          <label>
            Estad√≠sticas activas
            <select name="SHOW_MODE_STATS_ENABLED">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
          <label>
            Heatmap activo
            <select name="SHOW_MODE_HEATMAP_ENABLED">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
          <label>
            Delta afinidad
            <input type="number" name="SHOW_MODE_REL_AFFINITY_DELTA" value="10">
          </label>
          <label>
            Delta conflicto
            <input type="number" name="SHOW_MODE_REL_CONFLICT_DELTA" value="8">
          </label>
          <label>
            Score afinidad
            <input type="number" name="SHOW_MODE_SCORE_AFFINITY" value="18">
          </label>
          <label>
            Score conflicto
            <input type="number" name="SHOW_MODE_SCORE_CONFLICT" value="22">
          </label>
          <label>
            Mult afinidad
            <input type="number" step="0.1" name="SHOW_MODE_AFFINITY_MULTIPLIER" value="1.4">
          </label>
          <label>
            Mult conflicto
            <input type="number" step="0.1" name="SHOW_MODE_CONFLICT_MULTIPLIER" value="1.5">
          </label>
          <label>
            Mult cl√≠max
            <input type="number" step="0.1" name="SHOW_MODE_CLIMAX_MULTIPLIER" value="1.8">
          </label>
          <label>
            Bonus novedad
            <input type="number" name="SHOW_MODE_NOVELTY_BONUS" value="12">
          </label>
          <label>
            Radio testigos
            <input type="number" name="SHOW_MODE_WITNESS_RADIUS" value="6">
          </label>
          <label>
            Score por testigo
            <input type="number" name="SHOW_MODE_WITNESS_SCORE_PER" value="3">
          </label>
          <label>
            Score max testigos
            <input type="number" name="SHOW_MODE_WITNESS_SCORE_MAX" value="20">
          </label>
          <label>
            Mult keywords drama
            <input type="number" step="0.1" name="SHOW_MODE_KEYWORD_MULTIPLIER" value="1.3">
          </label>
          <label>
            Bonus pol√≠tica
            <input type="number" name="SHOW_MODE_POLITICA_BONUS" value="18">
          </label>
          <label>
            Bonus negocio
            <input type="number" name="SHOW_MODE_NEGOCIO_BONUS" value="10">
          </label>
          <label>
            L√≠mite predicciones
            <input type="number" name="SHOW_MODE_PREDICTIONS_LIMIT" value="4">
          </label>
          <label>
            Retenci√≥n heatmap (min)
            <input type="number" name="SHOW_MODE_HEATMAP_RETENTION_MIN" value="5">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-kick">
        <h2>Kick & Streaming</h2>
        <div class="panel-grid">
          <label>
            Kick chat URL
            <input type="text" name="KICK_CHAT_URL" placeholder="wss://...">
          </label>
          <label>
            Kick channel
            <input type="text" name="KICK_CHANNEL" placeholder="canal">
          </label>
          <label>
            Moderadores Kick (csv)
            <input type="text" name="KICK_MODS" placeholder="mod1,mod2">
          </label>
          <label>
            Prefijo de comandos
            <input type="text" name="KICK_COMMAND_PREFIX" value="!">
          </label>
          <label>
            Reconnect Kick (ms)
            <input type="number" name="KICK_RECONNECT_MS" value="5000">
          </label>
          <label>
            RTMP URL
            <input type="text" name="KICK_RTMP_URL" placeholder="rtmp://...">
          </label>
          <label>
            Stream key
            <input type="password" name="KICK_STREAM_KEY" placeholder="stream_key">
          </label>
          <label>
            URL frontend stream
            <input type="text" name="STREAM_FRONTEND_URL" value="http://localhost:5173">
          </label>
          <label>
            FPS stream
            <input type="number" name="STREAM_FPS" value="30">
          </label>
          <label>
            Resoluci√≥n stream
            <input type="text" name="STREAM_RESOLUTION" value="1280x720">
          </label>
          <label>
            Bitrate stream
            <input type="text" name="STREAM_BITRATE" value="2500k">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-analytics">
        <h2>Analytics</h2>
        <div class="panel-grid">
          <label>
            Intervalo analytics (ms)
            <input type="number" name="ANALYTICS_RECORD_INTERVAL_MS" value="10000">
          </label>
        </div>
      </section>

      <section class="admin-panel" id="panel-observability">
        <h2>Observabilidad</h2>
        <div class="panel-grid">
          <label>
            Snapshot interval (ms)
            <input type="number" name="WORLD_SNAPSHOT_INTERVAL_MS" value="60000">
          </label>
          <label>
            Snapshot al iniciar
            <select name="WORLD_SNAPSHOT_ON_START">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
          <label>
            Fuente de snapshot
            <select name="WORLD_SNAPSHOT_SOURCE">
              <option value="file">file</option>
              <option value="db">db</option>
            </select>
          </label>
          <label>
            Snapshot path
            <input type="text" name="WORLD_SNAPSHOT_PATH" value="world_snapshot.json">
          </label>
          <label>
            Snapshot archive dir
            <input type="text" name="WORLD_SNAPSHOT_ARCHIVE_DIR" placeholder="snapshot_archive">
          </label>
          <label>
            Snapshot retention
            <input type="number" name="WORLD_SNAPSHOT_ARCHIVE_RETENTION" value="10">
          </label>
          <label>
            Snapshot checksum
            <select name="WORLD_SNAPSHOT_ARCHIVE_CHECKSUM">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </label>
        </div>
      </section>

      <section class="admin-panel">
        <h2>Resumen JSON</h2>
        <div class="panel-hint">
          Cambios guardados requieren reinicio para aplicar settings de mundo y econom√≠a.
        </div>
        <pre class="config-preview" id="config-preview"></pre>
      </section>
    </main>
  </div>

  <div class="admin-lock" id="admin-lock">
    <div class="lock-card">
      <div class="lock-title">Panel de administraci√≥n</div>
      <p class="lock-copy">
        Ingresa tu clave de administraci√≥n para continuar. Esta vista controla todo el
        runtime de MOLTVILLE.
      </p>
      <input class="lock-input" id="lock-key-input" type="password" placeholder="ADMIN_API_KEY">
      <button class="primary lock-button" id="lock-enter" type="button">Desbloquear</button>
    </div>
  </div>

  <script src="./admin.js?v=20260210c"></script>
</body>
</html>
